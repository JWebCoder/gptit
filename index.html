<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>gptit</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0b0c10;
      --surface: #0f1117;
      --panel: #131720;
      --border: #1c2330;
      --text: #e8ecf2;
      --muted: #9aa4b5;
      --accent: #10a37f;
      --input: #0c1016;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      align-items: flex-start;
      justify-content: center;
      padding: 18px;
    }

    .app {
      width: min(1080px, 100%);
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    header {
      display: flex;
      align-items: center;
      gap: 10px;
      color: var(--muted);
      font-weight: 600;
      letter-spacing: 0.2px;
      padding: 6px 8px;
    }

    .logo {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-weight: 700;
      color: var(--text);
    }

    .logo span {
      background: linear-gradient(120deg, #10a37f, #9f7aea, #22d3ee);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .chat-window {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 18px;
      overflow: hidden;
      box-shadow: 0 14px 36px rgba(0,0,0,0.35);
    }

    .chat-messages {
      padding: 18px;
      display: grid;
      gap: 12px;
    }

    .message {
      display: flex;
      gap: 10px;
      align-items: flex-start;
    }

    .bubble {
      padding: 12px 14px;
      border-radius: 14px;
      background: var(--panel);
      border: 1px solid var(--border);
      color: var(--text);
      line-height: 1.4;
      width: 100%;
    }

    .bubble.system { color: var(--muted); background: rgba(255,255,255,0.02); }
    .bubble.user { background: #141a23; border-color: #243144; }

    .composer {
      border-top: 1px solid var(--border);
      padding: 14px 18px;
      display: grid;
      gap: 10px;
      background: var(--surface);
    }

    textarea {
      width: 100%;
      min-height: 120px;
      background: var(--input);
      border: 1px solid var(--border);
      color: var(--text);
      padding: 12px;
      border-radius: 12px;
      font-size: 1rem;
      resize: vertical;
    }

    textarea:focus { outline: 2px solid rgba(16, 163, 127, 0.4); border-color: rgba(16, 163, 127, 0.8); }

    .actions { display: flex; gap: 10px; flex-wrap: wrap; }
    button, .ghost {
      border: 1px solid var(--border);
      background: #18202c;
      color: var(--text);
      padding: 10px 14px;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 120ms ease, box-shadow 120ms ease, border-color 120ms ease;
    }

    button.secondary { background: #0f141c; }
    button:hover, .ghost:hover { transform: translateY(-1px); box-shadow: 0 8px 20px rgba(0,0,0,0.25); border-color: #2f3a4d; }

    .link-box {
      border: 1px dashed var(--border);
      border-radius: 12px;
      padding: 10px;
      display: grid;
      gap: 8px;
      background: #10141c;
    }

    .link-row { display: flex; gap: 10px; align-items: center; }
    .link-text {
      flex: 1;
      padding: 8px 10px;
      background: #0f141c;
      border: 1px solid var(--border);
      border-radius: 10px;
      color: var(--muted);
      word-break: break-all;
      font-size: 0.95rem;
    }

    .demo-status { color: var(--muted); font-size: 0.95rem; }
    .progress { height: 6px; border-radius: 999px; background: rgba(148, 163, 184, 0.1); overflow: hidden; margin-top: 8px; }
    .fill { height: 100%; width: 0%; background: linear-gradient(90deg, #0ea371, #1dd197); transition: width 240ms ease; }

    @media (max-width: 720px) {
      body { padding: 12px; }
      textarea { min-height: 110px; }
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="logo"><span>gptit</span></div>
      <div>Replica o fluxo do ChatGPT com um link partilhável.</div>
    </header>

    <div class="chat-window" id="home" hidden>
      <div class="chat-messages">
        <div class="message">
          <div class="bubble system">
            Escreve o prompt e gera um link gptit. Se preferires, testa já a reprodução com o botão “Testar”.
          </div>
        </div>
      </div>
      <div class="composer">
        <textarea id="prompt" placeholder="Explica-me como montar um plano semanal com 30€."></textarea>
        <div class="actions">
          <button id="makeLink">Gerar link</button>
          <button class="secondary" id="test">Testar</button>
        </div>
        <div class="link-box" id="linkBox" hidden>
          <div class="link-row">
            <div class="link-text" id="linkText"></div>
            <button class="secondary" id="copyLink">Copiar</button>
          </div>
          <div class="actions">
            <a class="ghost" id="openDemo" href="#" target="_blank" rel="noopener noreferrer">Abrir demo em novo separador</a>
          </div>
        </div>
      </div>
    </div>

    <div class="chat-window" id="demo" hidden>
      <div class="chat-messages">
        <div class="message">
          <div class="bubble system demo-status">
            <strong>Status:</strong> <span id="status">A preparar…</span>
            <div class="progress"><div class="fill" id="fill"></div></div>
          </div>
        </div>
        <div class="message" id="previewRow" hidden>
          <div class="bubble user" id="preview"></div>
        </div>
      </div>
      <div class="composer">
        <div class="actions">
          <a class="ghost" id="openChat" href="https://chatgpt.com" target="_blank" rel="noopener noreferrer">Abrir no ChatGPT</a>
          <button class="secondary" id="reset">Limpar e voltar</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const prePrompt = params.get('prompt');

    const home = document.getElementById('home');
    const demo = document.getElementById('demo');
    const promptInput = document.getElementById('prompt');
    const makeLinkBtn = document.getElementById('makeLink');
    const testBtn = document.getElementById('test');
    const linkBox = document.getElementById('linkBox');
    const linkText = document.getElementById('linkText');
    const copyBtn = document.getElementById('copyLink');
    const openDemo = document.getElementById('openDemo');

    const statusEl = document.getElementById('status');
    const fill = document.getElementById('fill');
    const preview = document.getElementById('preview');
    const previewRow = document.getElementById('previewRow');
    const openChat = document.getElementById('openChat');
    const resetBtn = document.getElementById('reset');

    const steps = [
      { label: 'A preparar o gptit…', delay: 400 },
      { label: 'A escrever o prompt automaticamente…', delay: 900, type: true },
      { label: 'A convocar o ChatGPT…', delay: 700 },
      { label: 'Apegar uma resposta incrível…', delay: 700 },
      { label: 'Pronto! Podes abrir no ChatGPT.', delay: 0 }
    ];

    const buildLink = (prompt) => {
      const base = `${window.location.origin}${window.location.pathname}`;
      return `${base}?prompt=${encodeURIComponent(prompt)}`;
    };

    const showHome = () => {
      home.hidden = false;
      demo.hidden = true;
      fill.style.width = '0%';
      statusEl.textContent = 'A preparar…';
      preview.hidden = true;
      previewRow.hidden = true;
      preview.textContent = '';
    };

    const showDemo = () => {
      home.hidden = true;
      demo.hidden = false;
    };

    const copyLink = async () => {
      try {
        await navigator.clipboard.writeText(linkText.textContent);
        copyBtn.textContent = 'Copiado!';
        setTimeout(() => (copyBtn.textContent = 'Copiar'), 1400);
      } catch (err) {
        copyBtn.textContent = 'Erro';
        console.error(err);
      }
    };

    const typeText = (text, onDone) => {
      statusEl.textContent = '';
      let i = 0;
      const interval = setInterval(() => {
        statusEl.textContent += text.charAt(i);
        i += 1;
        if (i >= text.length) {
          clearInterval(interval);
          onDone?.();
        }
      }, 24);
    };

    const runSteps = (prompt) => {
      if (!prompt) {
        statusEl.textContent = 'Falta o prompt para testar.';
        return;
      }

      let progress = 0;
      fill.style.width = '0%';
      preview.hidden = true;
      preview.textContent = '';

      steps.forEach((step, index) => {
        const handler = () => {
          progress = Math.round(((index + 1) / steps.length) * 100);
          fill.style.width = `${progress}%`;
          const next = () => {
            if (index === steps.length - 1) {
              preview.textContent = prompt;
              preview.hidden = false;
              previewRow.hidden = false;
              statusEl.textContent = 'Tudo pronto. Abre no ChatGPT ou limpa para voltar.';
            } else {
              steps[index + 1]?.__timer?.();
            }
          };

          if (step.type) {
            typeText(step.label, next);
          } else {
            statusEl.textContent = step.label;
            setTimeout(next, step.delay);
          }
        };
        step.__timer = handler;
      });

      steps[0].__timer?.();
    };

    const handleMakeLink = () => {
      const prompt = promptInput.value.trim();
      if (!prompt) {
        linkBox.hidden = true;
        return;
      }
      const link = buildLink(prompt);
      linkText.textContent = link;
      linkBox.hidden = false;
      openDemo.href = link;
    };

    const handleTest = () => {
      const prompt = promptInput.value.trim();
      if (!prompt) return;
      window.location.href = buildLink(prompt);
    };

    makeLinkBtn.addEventListener('click', handleMakeLink);
    testBtn.addEventListener('click', handleTest);
    copyBtn.addEventListener('click', copyLink);

    resetBtn.addEventListener('click', () => {
      window.location.href = window.location.pathname;
    });

    if (prePrompt) {
      showDemo();
      const prompt = prePrompt;
      preview.textContent = prompt;
      preview.hidden = false;
      previewRow.hidden = false;
      openChat.href = `https://chatgpt.com/?q=${encodeURIComponent(prompt)}`;
      runSteps(prompt);
    } else {
      showHome();
    }
  </script>
</body>
</html>
