<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>gptit</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0f172a;
      --panel: #0b1324;
      --border: #1e293b;
      --text: #e2e8f0;
      --muted: #94a3b8;
      --accent: #22d3ee;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      background: radial-gradient(circle at 10% 10%, rgba(34, 211, 238, 0.08), transparent 20%),
                  radial-gradient(circle at 80% 0%, rgba(168, 85, 247, 0.06), transparent 18%),
                  var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }

    .shell {
      width: min(900px, 100%);
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 18px 40px rgba(0,0,0,0.35);
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 12px;
    }

    .logo { display: inline-flex; align-items: center; gap: 10px; font-weight: 700; }
    .logo span { background: linear-gradient(120deg, #22d3ee, #a855f7, #ec4899); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .chip { color: var(--muted); font-size: 0.9rem; }

    h1 { margin: 8px 0; font-size: 1.3rem; }
    p { margin: 6px 0 14px; color: var(--muted); }

    label { display: block; font-weight: 600; margin-bottom: 6px; }
    textarea {
      width: 100%;
      min-height: 140px;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid var(--border);
      color: var(--text);
      padding: 12px;
      border-radius: 12px;
      font-size: 1rem;
      resize: vertical;
    }

    textarea:focus { outline: 2px solid rgba(34, 211, 238, 0.4); border-color: rgba(34, 211, 238, 0.8); }

    .buttons { display: flex; gap: 10px; margin-top: 12px; flex-wrap: wrap; }
    button, .ghost {
      border: 1px solid var(--border);
      background: linear-gradient(120deg, rgba(34, 211, 238, 0.3), rgba(168, 85, 247, 0.2));
      color: var(--text);
      padding: 10px 14px;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 120ms ease, box-shadow 120ms ease;
    }

    button.secondary { background: rgba(255, 255, 255, 0.03); }
    button:hover, .ghost:hover { transform: translateY(-1px); box-shadow: 0 8px 20px rgba(0,0,0,0.28); }

    .link-box {
      margin-top: 12px;
      padding: 10px;
      border: 1px dashed var(--border);
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.02);
      display: grid;
      gap: 8px;
    }

    .link-row { display: flex; gap: 10px; align-items: center; }
    .link-text {
      flex: 1;
      padding: 8px 10px;
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid var(--border);
      border-radius: 10px;
      color: var(--muted);
      word-break: break-all;
      font-size: 0.95rem;
    }

    .demo-box {
      margin-top: 16px;
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px;
      background: rgba(255, 255, 255, 0.02);
    }

    .status { display: flex; gap: 8px; align-items: center; color: var(--muted); }
    .status strong { color: var(--text); }

    .timeline { margin-top: 10px; height: 6px; border-radius: 999px; background: rgba(148, 163, 184, 0.1); overflow: hidden; }
    .fill { height: 100%; width: 0%; background: linear-gradient(90deg, #22d3ee, #a855f7); transition: width 240ms ease; }

    .preview {
      margin-top: 10px;
      padding: 10px;
      border-radius: 10px;
      border: 1px solid rgba(34, 211, 238, 0.45);
      background: rgba(34, 211, 238, 0.08);
      color: #def9ff;
      font-size: 0.95rem;
      white-space: pre-wrap;
    }

    .demo-actions { display: flex; gap: 10px; margin-top: 12px; flex-wrap: wrap; }
    .ghost { text-decoration: none; display: inline-flex; align-items: center; gap: 6px; }
  </style>
</head>
<body>
  <div class="shell">
    <header>
      <div class="logo"><span>gptit</span></div>
      <div class="chip">letmechatgptthat.com</div>
    </header>

    <div id="home" hidden>
      <h1>Cria o link gptit</h1>
      <p>Uma caixa de texto, dois botões. Gera o link ou testa já.</p>
      <label for="prompt">Prompt</label>
      <textarea id="prompt" placeholder="Explica-me como montar um plano semanal com 30€."></textarea>
      <div class="buttons">
        <button id="makeLink">Gerar link</button>
        <button class="secondary" id="test">Testar</button>
      </div>
      <div class="link-box" id="linkBox" hidden>
        <div class="link-row">
          <div class="link-text" id="linkText"></div>
          <button class="secondary" id="copyLink">Copiar</button>
        </div>
        <div class="buttons">
          <a class="ghost" id="openDemo" href="#" target="_blank" rel="noopener noreferrer">Abrir demo em novo separador</a>
        </div>
      </div>
    </div>

    <div id="demo" hidden>
      <h1>Demo gptit</h1>
      <p>Reprodução rápida do percurso. O botão abre o ChatGPT numa nova aba.</p>
      <div class="demo-box">
        <div class="status"><strong>Status:</strong> <span id="status">A preparar…</span></div>
        <div class="timeline"><div class="fill" id="fill"></div></div>
        <div class="preview" id="preview" hidden></div>
        <div class="demo-actions">
          <a class="ghost" id="openChat" href="https://chatgpt.com" target="_blank" rel="noopener noreferrer">Abrir no ChatGPT</a>
          <button class="secondary" id="reset">Limpar e voltar</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const prePrompt = params.get('prompt');

    const home = document.getElementById('home');
    const demo = document.getElementById('demo');
    const promptInput = document.getElementById('prompt');
    const makeLinkBtn = document.getElementById('makeLink');
    const testBtn = document.getElementById('test');
    const linkBox = document.getElementById('linkBox');
    const linkText = document.getElementById('linkText');
    const copyBtn = document.getElementById('copyLink');
    const openDemo = document.getElementById('openDemo');

    const statusEl = document.getElementById('status');
    const fill = document.getElementById('fill');
    const preview = document.getElementById('preview');
    const openChat = document.getElementById('openChat');
    const resetBtn = document.getElementById('reset');

    const steps = [
      { label: 'A preparar o gptit…', delay: 400 },
      { label: 'A escrever o prompt automaticamente…', delay: 900, type: true },
      { label: 'A convocar o ChatGPT…', delay: 700 },
      { label: 'Apegar uma resposta incrível…', delay: 700 },
      { label: 'Pronto! Podes abrir no ChatGPT.', delay: 0 }
    ];

    const buildLink = (prompt) => {
      const base = `${window.location.origin}${window.location.pathname}`;
      return `${base}?prompt=${encodeURIComponent(prompt)}`;
    };

    const showHome = () => {
      home.hidden = false;
      demo.hidden = true;
      fill.style.width = '0%';
      statusEl.textContent = 'A preparar…';
      preview.hidden = true;
      preview.textContent = '';
    };

    const showDemo = () => {
      home.hidden = true;
      demo.hidden = false;
    };

    const copyLink = async () => {
      try {
        await navigator.clipboard.writeText(linkText.textContent);
        copyBtn.textContent = 'Copiado!';
        setTimeout(() => (copyBtn.textContent = 'Copiar'), 1400);
      } catch (err) {
        copyBtn.textContent = 'Erro';
        console.error(err);
      }
    };

    const typeText = (text, onDone) => {
      statusEl.textContent = '';
      let i = 0;
      const interval = setInterval(() => {
        statusEl.textContent += text.charAt(i);
        i += 1;
        if (i >= text.length) {
          clearInterval(interval);
          onDone?.();
        }
      }, 24);
    };

    const runSteps = (prompt) => {
      if (!prompt) {
        statusEl.textContent = 'Falta o prompt para testar.';
        return;
      }

      let progress = 0;
      fill.style.width = '0%';
      preview.hidden = true;
      preview.textContent = '';

      steps.forEach((step, index) => {
        const handler = () => {
          progress = Math.round(((index + 1) / steps.length) * 100);
          fill.style.width = `${progress}%`;
          const next = () => {
            if (index === steps.length - 1) {
              preview.textContent = prompt;
              preview.hidden = false;
              statusEl.textContent = 'Tudo pronto. Abre no ChatGPT ou limpa para voltar.';
            } else {
              steps[index + 1]?.__timer?.();
            }
          };

          if (step.type) {
            typeText(step.label, next);
          } else {
            statusEl.textContent = step.label;
            setTimeout(next, step.delay);
          }
        };
        step.__timer = handler;
      });

      steps[0].__timer?.();
    };

    const handleMakeLink = () => {
      const prompt = promptInput.value.trim();
      if (!prompt) {
        linkBox.hidden = true;
        return;
      }
      const link = buildLink(prompt);
      linkText.textContent = link;
      linkBox.hidden = false;
      openDemo.href = link;
    };

    const handleTest = () => {
      const prompt = promptInput.value.trim();
      if (!prompt) return;
      window.location.href = buildLink(prompt);
    };

    makeLinkBtn.addEventListener('click', handleMakeLink);
    testBtn.addEventListener('click', handleTest);
    copyBtn.addEventListener('click', copyLink);

    resetBtn.addEventListener('click', () => {
      window.location.href = window.location.pathname;
    });

    if (prePrompt) {
      showDemo();
      const prompt = prePrompt;
      preview.textContent = prompt;
      openChat.href = `https://chatgpt.com/?q=${encodeURIComponent(prompt)}`;
      runSteps(prompt);
    } else {
      showHome();
    }
  </script>
</body>
</html>
